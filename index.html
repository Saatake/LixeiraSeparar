<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lixeira Separar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    h1 {
      margin-bottom: 20px;
    }
    button {
      font-size: 18px;
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #reciclavel {
      background-color: #4CAF50;
      color: white;
    }
    #organico {
      background-color: #f39c12;
      color: white;
    }
    #pontos {
      font-size: 22px;
      margin-top: 20px;
      color: #333;
    }
    .loja {
      margin-top: 50px;
      text-align: left;
      max-width: 600px;
      margin: 50px auto;
    }
    .item {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .item img {
      max-width: 80px;
      max-height: 80px;
      border-radius: 8px;
    }
    .item button {
      background-color: #3498db;
      color: white;
      font-size: 16px;
      padding: 10px 20px;
    }
  </style>
</head>
<body>
  <h1>Controle da Lixeira</h1>
  <button id="reciclavel" onclick="enviarComando('reciclavel')">Reciclável</button>
  <button id="organico" onclick="enviarComando('organico')">Orgânico</button>

  <p id="pontos">Você tem: <span id="pontos-valor">0</span> pontos</p>

  <div class="loja">
    <h2>Loja de Pontos</h2>
    <div class="item">
      <img src="item1.jpg" alt="Item 1">
      <div>
        <p>Item 1</p>
        <button onclick="comprarItem(10)">Comprar por 10 pontos</button>
      </div>
    </div>
    <div class="item">
      <img src="item2.jpg" alt="Item 2">
      <div>
        <p>Item 2</p>
        <button onclick="comprarItem(20)">Comprar por 20 pontos</button>
      </div>
    </div>
  </div>

  <!-- SDK Firebase Compatível -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCFOh6xEHlS_yuC9Rp3u8hdaUmZrn-uPPA",
      authDomain: "upx2-99a8e.firebaseapp.com",
      databaseURL: "https://upx2-99a8e-default-rtdb.firebaseio.com",
      projectId: "upx2-99a8e",
      storageBucket: "upx2-99a8e.firebasestorage.app",
      messagingSenderId: "441113316559",
      appId: "1:441113316559:web:c26cf7fccac53abb40bbba"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Variável para armazenar pontos
    let pontos = 0;

    // Atualizar pontos na tela
    function atualizarPontos(valor) {
      pontos = valor;
      document.getElementById("pontos-valor").innerText = pontos;
    }

    // Ler pontos do Firebase
    function lerPontos() {
      database.ref("/pontos").on("value", (snapshot) => {
        const valor = snapshot.val() || 0;
        atualizarPontos(valor);
      });
    }

    // Enviar comandos
    function enviarComando(comando) {
      database.ref("/").update({
        comando: comando
      })
      .then(() => console.log("Comando enviado: " + comando))
      .catch((error) => console.error("Erro ao enviar comando: ", error));
    }

    // Comprar item
    function comprarItem(preco) {
      if (pontos >= preco) {
        const novosPontos = pontos - preco;
        database.ref("/").update({ pontos: novosPontos })
          .then(() => alert("Compra realizada com sucesso!"))
          .catch((error) => console.error("Erro ao atualizar pontos: ", error));
      } else {
        alert("Pontos insuficientes para realizar a compra.");
      }
    }

    // Resetar pontos ao digitar "zeropontos" no Serial
    function resetarPontos() {
      database.ref("/").update({ pontos: 0 })
        .then(() => console.log("Pontos zerados"))
        .catch((error) => console.error("Erro ao resetar pontos: ", error));
    }

    // Inicializar leitura de pontos
    lerPontos();
  </script>
</body>
</html>
